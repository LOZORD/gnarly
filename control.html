<!DOCTYPE html>
<html>
    <head>
        <title>Control Panel</title>
        <style>
            body {
                background-color: black;
                font-family: 'Courier New', Courier, monospace;
                color: gold;
            }
        </style>
    </head>
    <body>
        <h1>Control world!</h1>
        <form id="main-form">
            <input id="slider1" type="range" name="foo" value="3" min="0" max="10"/>
            <input id="slider2" type="range" name="bar" value="7" min="0" max="10"/>
        </form>
        <button id="broadcast-button">Click me!</button>
    </body>
    <script>
        console.log('hello from control window');

        const form = document.getElementById('main-form');

        function getFormData() {
            const formData = {};
            for (const input of form.elements) {
                formData[input.name] = parseFloat(input.value);
            }
            return formData;
        }

        const channel = new BroadcastChannel('gnarly');

        const btn = document.getElementById('broadcast-button');

        btn.addEventListener('click', () => {
            channel.postMessage({
                'control': getFormData(),
                'date': new Date(),
            });
        });

        form.oninput = (event) => {
            event.preventDefault();
            channel.postMessage({
                'control': getFormData(),
                'date': new Date(),
            });
        };
    </script>
</html>